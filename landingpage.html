<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8">
        <title>WSU Arboretum</title>
        <meta name="viewport" content="width=device-width,initial-scale=1">
        <link rel="stylesheet" href="style.css">
        <link href="https://fonts.googleapis.com/css?family=Poppins:100,100italic,200,200italic,300,300italic,regular,italic,500,500italic,600,600italic,700,700italic,800,800italic,900,900italic" rel="stylesheet" />
        <link rel="icon" href="/favicon.png">
    </head>
     
    <body>
        <div class="header" id="header">
            <!-- <h1>WSU Arboretum</h1> -->
            <i class="fas fa-clock"> </i>
            <div class="headerButtons">
                <div class="take-a-tour" style="width:100%">
                    <button style="width:50%" onclick="window.location.href='tour.html'">Take a Tour!</button>
                </div>
                <div class="tour-listing">
                    <button style="width:50%" onclick= "window.location.href='listing.html'">Tour Listing</button>
                </div>
            </div>
        </div>
       
        
        <div class="search-function">
            <img id = "logo" src="arboretumlogo.png">
            <img id = "wsu-logo" src="Flaming_W_Color.jpg">
            <style>
                #wsu-logo{
                    position: absolute;
                    top: 60px; /* set the top position to 100 pixels from the top of the page */
                    left: 370px; 
                 width: 55px; /* set the width of the image to 200 pixels */
                height: auto; /* set the height of the image to auto, which will preserve the aspect ratio */
                }

                #logo {
                    position: absolute;
                    top: 70px; /* set the top position to 100 pixels from the top of the page */
                    left: 10px; 
                 width: 200px; /* set the width of the image to 200 pixels */
                height: auto; /* set the height of the image to auto, which will preserve the aspect ratio */
                }
            </style>
            <h2>Welcome to the Arboretum</h2><br>
            <form autocomplete="off">
                <div class="autocomplete">
                    <input type="text" class="searchInput" id="searchInput" placeholder="Search for a Tree!" onKeyUp="results(this.value)"><br>
                </div>
                <div id="auto-results" onclick="lookup(event)"></div>
                <div id="result">
                    <h4 id="resultName"></h4>
                    <img id="resultImg"><br>
                    <p id="resultDesc"></p>
                </div>
            </form>
        </div>
        <script>





            var treeArray = [];
            var tree = "";
            window.onload = function() {
                // carousel();
                var xhttp = new XMLHttpRequest();
                xhttp.open("GET", "1.xml", true);
                xhttp.send();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200){
                        XMLtoArray(this);
                    }
                };
               
            }
            function XMLtoArray(xml) {
                var x, i, xmlDoc;
                xmlDoc = xml.responseXML;
                x = xmlDoc.getElementsByTagName("ThemeEntityAbridgedData");
                for (i = 0; i< x.length; i++) {
                    treeArray[i] = x[i].childNodes[1].innerHTML;
                }
                showImg(xml);
            }

            
            function autocomplete(input){
                if (input == ""){
                    return []; //return nothing if blank
                }
                var termToMatch = new RegExp(input, "i");
                var matchingTerms = treeArray.filter(function(searchTerm) {
                    if(searchTerm.match(termToMatch)){  // match terms with treeArray
                        return searchTerm.match(termToMatch);
                    }
                });
                return matchingTerms.slice(0, 10).sort();
            }
            function results(inp){
                result = document.getElementById("auto-results");
                result.innerHTML = "";
                let resultList = "";
                let searchTerms = autocomplete(inp);
                for(i = 0; i < searchTerms.length; i++){
                    resultList += "<li>" + searchTerms[i] + "</li>";
                }
                result.innerHTML = "<ul>" + resultList + "</ul>";
            }
            function lookup(event){
                tree = event.target.textContent;
                var xhttp = new XMLHttpRequest();
                xhttp.open("GET", "1.xml", true);
                xhttp.send();
                xhttp.onreadystatechange = function() {
                    if (this.readyState == 4 && this.status == 200){
                        pullImage(this, tree);
                    }
                };
            }
            function pullImage(xml){
                var x, i, xmlDoc;
                xmlDoc = xml.responseXML;
                x = xmlDoc.getElementsByTagName("ThemeEntityAbridgedData");
                for (i = 0; i< x.length; i++) {
                    document.getElementById("resultImg").alt = tree;
                    document.getElementById("resultName").innerHTML = tree;
                    if (x[i].childNodes[1].innerHTML == tree){
                        document.getElementById("resultImg").src = x[i].childNodes[0].innerHTML;
                    }
                }
            }
            var slideIndex = 0;

            function showImg(xml) {
             

                var xmlDoc = xml.responseXML;
                var x = xmlDoc.getElementsByTagName("ThemeEntityAbridgedData");
                var img = document.getElementById("resultImg");
                var i = 1;

                img.classList.add("image-slider");
                img.src = x[0].childNodes[0].innerHTML;

                interval = setInterval(function() {
                    if (tree != ""){
                        clearInterval(interval);
                        return;
                    }
                    // fade out current image
                    img.style.opacity = 0;
    
                    setTimeout(function() {
                    // set new image source and fade in
                    img.src = x[i].childNodes[0].innerHTML;
                    img.style.opacity = 1;
                    i = (i + 1) % x.length; // increment index and loop back to 0 when we reach the end
                    }, 2000); // wait for fade out transition to complete before updating image source and fading in
                }, 6000); // call the function every 4 seconds
   
            }
                       
        </script>

    </body>
    <footer class="footer">
        <p>
           Contact: Nathan Anderson <br>
            <a class="email" href="mailto:nathan.anderson@winona.edu" title="Email Nathan Anderson">nathan.anderson@winona.edu</a>
        </p>
    </footer>
</html>